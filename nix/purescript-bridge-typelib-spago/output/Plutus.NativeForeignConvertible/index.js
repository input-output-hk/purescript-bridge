// Generated by purs version 0.14.5
"use strict";
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Boolean = require("../Data.Boolean/index.js");
var Data_Eq = require("../Data.Eq/index.js");
var Data_Function = require("../Data.Function/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Data_Newtype = require("../Data.Newtype/index.js");
var Data_Semigroup = require("../Data.Semigroup/index.js");
var Data_Semiring = require("../Data.Semiring/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Data_UInt = require("../Data.UInt/index.js");
var Plutus_Types_AddressHeaderType = require("../Plutus.Types.AddressHeaderType/index.js");
var Plutus_Types_Credential = require("../Plutus.Types.Credential/index.js");
var Serialization_Address = require("../Serialization.Address/index.js");
var Serialization_Hash = require("../Serialization.Hash/index.js");
var Types_ByteArray = require("../Types.ByteArray/index.js");
var toNativeType = function (dict) {
    return dict.toNativeType;
};
var toForeignType = function (dict) {
    return dict.toForeignType;
};
var _toVarLengthUInt = function (dictNewtype) {
    return function (t) {
        var worker = function (srcUInt) {
            return function (setSignalBit) {
                if (Data_Eq.eq(Data_UInt.uintEqInstance)(srcUInt)(Data_Semiring.zero(Data_UInt.uintSemiring))) {
                    return Data_Monoid.mempty(Types_ByteArray.monoidByteArray);
                };
                if (Data_Boolean.otherwise) {
                    var uint7 = Data_UInt.and(srcUInt)(Data_UInt.fromInt(127));
                    var srcUIntShifted = Data_UInt.zshr(srcUInt)(Data_UInt.fromInt(7));
                    return Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(worker(srcUIntShifted)(true))(Types_ByteArray.byteArrayFromIntArrayUnsafe(Data_Array.singleton(Data_UInt.toInt((function () {
                        if (setSignalBit) {
                            return Data_UInt.or(uint7)(Data_UInt.fromInt(128));
                        };
                        return uint7;
                    })()))));
                };
                throw new Error("Failed pattern match at Plutus.NativeForeignConvertible (line 273, column 3 - line 273, column 41): " + [ srcUInt.constructor.name, setSignalBit.constructor.name ]);
            };
        };
        return worker(Data_Newtype.unwrap()(t))(false);
    };
};
var _fromVarLengthUInt = function (dictNewtype) {
    return function (bytes) {
        return function (acc) {
            return Control_Bind.bind(Data_Maybe.bindMaybe)(Data_Array.uncons(bytes))(function (v) {
                var x = Data_UInt.fromInt(v.head);
                var v1 = Data_Eq.eq(Data_UInt.uintEqInstance)(Data_UInt.and(x)(Data_UInt.fromInt(128)))(Data_Semiring.zero(Data_UInt.uintSemiring));
                if (v1) {
                    var uintArray = Data_Function.flip(Data_Functor.map(Data_Functor.functorArray))(Data_Array.snoc(acc)(x))(Data_UInt.and(Data_UInt.fromInt(127)));
                    var foldr_ = function (m) {
                        return function (t) {
                            return function (f) {
                                return Data_Array.foldr(f)(m)(t);
                            };
                        };
                    };
                    var uintValue = Data_Tuple.fst(foldr_(new Data_Tuple.Tuple(Data_Semiring.zero(Data_UInt.uintSemiring), 0))(uintArray)(function (lhs) {
                        return function (v2) {
                            return new Data_Tuple.Tuple(Data_Semiring.add(Data_UInt.uintSemiring)(Data_UInt.shl(lhs)(Data_UInt.fromInt(7 * v2.value1 | 0)))(v2.value0), v2.value1 + 1 | 0);
                        };
                    }));
                    return Data_Maybe.Just.create(new Data_Tuple.Tuple(Data_Newtype.wrap()(uintValue), v.tail));
                };
                return _fromVarLengthUInt()(v.tail)(Data_Array.snoc(acc)(x));
            });
        };
    };
};
var nativeForeignConvertibleA = {
    toForeignType: function (addrPlutus) {
        var rec = Data_Newtype.unwrap()(addrPlutus);
        var pointerToBytes = function (ptr) {
            return Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(_toVarLengthUInt()(ptr.slot))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(_toVarLengthUInt()(ptr.txIx))(_toVarLengthUInt()(ptr.certIx)));
        };
        var addrHeader = function (headerType) {
            return Types_ByteArray.byteArrayFromIntArrayUnsafe(Data_Array.singleton(Data_UInt.toInt(Data_Semiring.add(Data_UInt.uintSemiring)(Data_UInt.shl(Plutus_Types_AddressHeaderType.addrHeaderTypeUInt(headerType))(Data_UInt.fromInt(4)))(Data_UInt.fromInt(1)))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.PubKeyCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && (rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingHash && rec.addressStakingCredential.value0.value0 instanceof Plutus_Types_Credential.PubKeyCredential))) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.PaymentKeyHash_StakeKeyHash.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressStakingCredential.value0.value0.value0)))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.ScriptCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && (rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingHash && rec.addressStakingCredential.value0.value0 instanceof Plutus_Types_Credential.PubKeyCredential))) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.ScriptHash_StakeKeyHash.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressStakingCredential.value0.value0.value0)))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.PubKeyCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && (rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingHash && rec.addressStakingCredential.value0.value0 instanceof Plutus_Types_Credential.ScriptCredential))) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.PaymentKeyHash_ScriptHash.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressStakingCredential.value0.value0.value0)))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.ScriptCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && (rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingHash && rec.addressStakingCredential.value0.value0 instanceof Plutus_Types_Credential.ScriptCredential))) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.ScriptHash_ScriptHash.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressStakingCredential.value0.value0.value0)))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.PubKeyCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingPtr)) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.PaymentKeyHash_Pointer.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(pointerToBytes(rec.addressStakingCredential.value0.value0))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.ScriptCredential && (rec.addressStakingCredential instanceof Data_Maybe.Just && rec.addressStakingCredential.value0 instanceof Plutus_Types_Credential.StakingPtr)) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.ScriptHash_Pointer.value))(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0)))(pointerToBytes(rec.addressStakingCredential.value0.value0))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.PubKeyCredential && rec.addressStakingCredential instanceof Data_Maybe.Nothing) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.PaymentKeyHash.value))(Serialization_Hash.ed25519KeyHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0))));
        };
        if (rec.addressCredential instanceof Plutus_Types_Credential.ScriptCredential && rec.addressStakingCredential instanceof Data_Maybe.Nothing) {
            return Serialization_Address.addressFromBytes(Data_Semigroup.append(Types_ByteArray.semigroupByteArray)(addrHeader(Plutus_Types_AddressHeaderType.ScriptHash.value))(Serialization_Hash.scriptHashToBytes(Data_Newtype.unwrap()(rec.addressCredential.value0))));
        };
        throw new Error("Failed pattern match at Plutus.NativeForeignConvertible (line 69, column 5 - line 122, column 45): " + [ rec.addressCredential.constructor.name, rec.addressStakingCredential.constructor.name ]);
    },
    toNativeType: function (addrForeign) {
        var stakingPtr = function (byteArray) {
            return Control_Bind.bind(Data_Maybe.bindMaybe)(_fromVarLengthUInt()(Types_ByteArray.byteArrayToIntArray(byteArray))([  ]))(function (v) {
                return Control_Bind.bind(Data_Maybe.bindMaybe)(_fromVarLengthUInt()(v.value1)([  ]))(function (v1) {
                    return Control_Bind.bind(Data_Maybe.bindMaybe)(_fromVarLengthUInt()(v1.value1)([  ]))(function (v2) {
                        return Control_Applicative.pure(Data_Maybe.applicativeMaybe)(new Plutus_Types_Credential.StakingPtr({
                            slot: v.value0,
                            txIx: v1.value0,
                            certIx: v2.value0
                        }));
                    });
                });
            });
        };
        var scriptCredential = (function () {
            var $59 = Data_Functor.map(Data_Maybe.functorMaybe)((function () {
                var $61 = Data_Newtype.wrap();
                return function ($62) {
                    return Plutus_Types_Credential.ScriptCredential.create($61($62));
                };
            })());
            return function ($60) {
                return $59(Serialization_Hash.scriptHashFromBytes($60));
            };
        })();
        var pubKeyCredential = (function () {
            var $63 = Data_Functor.map(Data_Maybe.functorMaybe)((function () {
                var $65 = Data_Newtype.wrap();
                return function ($66) {
                    return Plutus_Types_Credential.PubKeyCredential.create($65($66));
                };
            })());
            return function ($64) {
                return $63(Serialization_Hash.ed25519KeyHashFromBytes($64));
            };
        })();
        var addrBytes = Types_ByteArray.byteArrayToIntArray(Serialization_Address.addressBytes(addrForeign));
        var addrType = Control_Bind.bind(Data_Maybe.bindMaybe)(Data_Array.head(addrBytes))((function () {
            var $67 = Control_Applicative.pure(Data_Maybe.applicativeMaybe);
            var $68 = Data_Function.flip(Data_UInt.zshr)(Data_UInt.fromInt(4));
            return function ($69) {
                return $67($68(Data_UInt.fromInt($69)));
            };
        })());
        var delegationPartHash = Types_ByteArray.byteArrayFromIntArray(Data_Array.drop(29)(addrBytes));
        var paymentPartHash = Types_ByteArray.byteArrayFromIntArray(Data_Array.take(28)(Data_Array.drop(1)(addrBytes)));
        var buildAddress = function (credential) {
            return function (stakingCredential) {
                return Control_Bind.bind(Data_Maybe.bindMaybe)(Control_Bind.bind(Data_Maybe.bindMaybe)(paymentPartHash)(credential))(function (c) {
                    if (stakingCredential instanceof Data_Maybe.Nothing) {
                        return Data_Maybe.Just.create(Data_Newtype.wrap()({
                            addressCredential: c,
                            addressStakingCredential: Data_Maybe.Nothing.value
                        }));
                    };
                    if (stakingCredential instanceof Data_Maybe.Just) {
                        return Control_Bind.bind(Data_Maybe.bindMaybe)(Control_Bind.bind(Data_Maybe.bindMaybe)(delegationPartHash)(stakingCredential.value0))(function (sc) {
                            return Data_Maybe.Just.create(Data_Newtype.wrap()({
                                addressCredential: c,
                                addressStakingCredential: new Data_Maybe.Just(sc)
                            }));
                        });
                    };
                    throw new Error("Failed pattern match at Plutus.NativeForeignConvertible (line 211, column 9 - line 216, column 79): " + [ stakingCredential.constructor.name ]);
                });
            };
        };
        return Control_Bind.bind(Data_Maybe.bindMaybe)(Control_Bind.bind(Data_Maybe.bindMaybe)(addrType)(Plutus_Types_AddressHeaderType.addrHeaderType))(function (addrType$prime) {
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.PaymentKeyHash_StakeKeyHash) {
                return buildAddress(pubKeyCredential)(Data_Maybe.Just.create((function () {
                    var $70 = Data_Functor.map(Data_Maybe.functorMaybe)(Plutus_Types_Credential.StakingHash.create);
                    return function ($71) {
                        return $70(pubKeyCredential($71));
                    };
                })()));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.ScriptHash_StakeKeyHash) {
                return buildAddress(scriptCredential)(Data_Maybe.Just.create((function () {
                    var $72 = Data_Functor.map(Data_Maybe.functorMaybe)(Plutus_Types_Credential.StakingHash.create);
                    return function ($73) {
                        return $72(pubKeyCredential($73));
                    };
                })()));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.PaymentKeyHash_ScriptHash) {
                return buildAddress(pubKeyCredential)(Data_Maybe.Just.create((function () {
                    var $74 = Data_Functor.map(Data_Maybe.functorMaybe)(Plutus_Types_Credential.StakingHash.create);
                    return function ($75) {
                        return $74(scriptCredential($75));
                    };
                })()));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.ScriptHash_ScriptHash) {
                return buildAddress(scriptCredential)(Data_Maybe.Just.create((function () {
                    var $76 = Data_Functor.map(Data_Maybe.functorMaybe)(Plutus_Types_Credential.StakingHash.create);
                    return function ($77) {
                        return $76(scriptCredential($77));
                    };
                })()));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.PaymentKeyHash_Pointer) {
                return buildAddress(pubKeyCredential)(new Data_Maybe.Just(stakingPtr));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.ScriptHash_Pointer) {
                return buildAddress(scriptCredential)(new Data_Maybe.Just(stakingPtr));
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.PaymentKeyHash) {
                return buildAddress(pubKeyCredential)(Data_Maybe.Nothing.value);
            };
            if (addrType$prime instanceof Plutus_Types_AddressHeaderType.ScriptHash) {
                return buildAddress(scriptCredential)(Data_Maybe.Nothing.value);
            };
            throw new Error("Failed pattern match at Plutus.NativeForeignConvertible (line 142, column 5 - line 177, column 46): " + [ addrType$prime.constructor.name ]);
        });
    }
};
module.exports = {
    toNativeType: toNativeType,
    toForeignType: toForeignType,
    nativeForeignConvertibleA: nativeForeignConvertibleA
};
